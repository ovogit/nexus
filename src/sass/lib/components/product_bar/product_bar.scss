$comet-background-color-product-bar-light = $comet-color-white;
$comet-background-color-product-bar = $comet-color-neutral-25;
$comet-size-product-bar-top-border-width = 5px;

.comet-product-bar {
    text-body();
    align-items: center;
    background: $comet-background-color-product-bar-light;
    border-top: solid $comet-size-product-bar-top-border-width $comet-color-interactive-default;
    display: flex;
    margin-bottom: 0;
    padding: $comet-space-inset-s;
    height: $comet-size-product-bar-height-s;
    width: 100%;
    
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        background: $comet-background-color-product-bar;
        height: $comet-size-product-bar-height-l;
    }
}

.comet-product-bar--theme-product-science {
    border-top-color: $comet-theme-product_science-color-light;
    
    .comet-product-bar__product-title-icon {
        fill: $comet-theme-product_science-color-light;
        
        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            fill: $comet-color-white;
        }
    }
}

.comet-product-bar--theme-product-social-studies {
    border-top-color: $comet-theme-product_social_studies-color-light;
    
    .comet-product-bar__product-title-icon {
        fill: $comet-theme-product_social_studies-color-light;
        width: 130px;
    
        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            fill: $comet-color-white;
        }
    }
}

.comet-product-bar--theme-product-math {
    border-top-color: $comet-theme-product_math-color-light;
    
    .comet-product-bar__product-title-icon {
        fill: $comet-theme-product_math-color-light;
        
        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            fill: $comet-color-white;
        }
    }
}

.comet-product-bar--theme-product-streaming {
    border-top-color: $comet-theme-product_streaming-color-light;
    
    .comet-product-bar__product-title-icon {
        fill: $comet-theme-product_streaming-color-light;
        
        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            fill: $comet-color-white;
        }
    }
}

.comet-global-brand-logo--hover-state {
    display: none;
    position: absolute;
    text-align: center;
    font-size: $comet-font-size-metadata;
    left: 12px;
}

.comet-global-brand-logo--hover-state-icon {
    fill: $comet-color-white;
    height: $comet-size-icon-m;
    width: $comet-size-icon-m;
    display: block; 
    margin: auto;
}

.comet-product-bar--legacy {
    .comet-global-brand-logo--dark-background {
        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            display: block;
        }
    }
}

.comet-product-bar--legacy {
    .comet-product-bar__global-brand {
        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            padding: $comet-size-default $comet-size-m;
            margin: -16px $comet-size-m -16px -8px; //no negative tokens
            border-radius: 0 $comet-border-radius $comet-border-radius 0;
            position: relative;
        }
    }

    .comet-product-bar__global-brand:hover, 
    .comet-product-bar__global-brand:focus {
        .comet-global-brand-logo--hover-state {
            display: block;
        }
        .comet-global-brand-logo--dark-background {
            opacity: 0;
        }
    }
}

.comet-product-bar--transparent,
.comet-product-bar--semi-transparent,
.comet-product-bar--gradient {
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        background-color: rgba($comet-background-color-product-bar, .25);
        margin-bottom: -($comet-size-product-bar-height-l - $comet-size-product-bar-top-border-width);
        position: relative;
        z-index: $comet-z-index-page-stack-page-header;
    }
}

.comet-product-bar--semi-transparent {
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        background-color: rgba($comet-background-color-product-bar, .75);
    }
}

.comet-product-bar--gradient {
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        background: linear-gradient(180deg, $comet-background-color-product-bar, rgba($comet-background-color-product-bar, 0));
    }
}

.comet-product-bar__back-link {
    margin: $comet-space-inline-left-xs;
}

.comet-product-bar__back-link-icon {
    height: $comet-size-icon-m;
    fill: $comet-color-neutral-38;
    width: $comet-size-icon-m;
    transition: fill comet-page-shell-transition-reveal();

    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        fill: $comet-color-white;
    }
}

.comet-product-bar__global-brand {
    align-items: center;
    display: flex;
    margin: $comet-space-inline-left-s;
    opacity: 1;
    transition: opacity comet-page-shell-transition-snap($comet-page-shell-transition-duration-s, $comet-page-shell-transition-duration-xs);

    .comet-page-shell--global-nav-bar-visible & {
        opacity: 0;
        transition: opacity comet-page-shell-transition-reveal($comet-page-shell-transition-duration-s);
    }
    
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        .comet-page-shell--global-nav-bar-visible &,
        & {
            opacity: 1;
        }
    }

    &:hover {
       text-decoration: none;
       background: transparent; //suppress hover state on smaller screens
    }

    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        color: $comet-color-white;
        &:hover {
            background: $comet-color-neutral-20;
        }
    }
}

.comet-global-brand-logo {
    width: 40px;

    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        display: none;
    }
}

.comet-global-brand-logo--dark-background {
    display: none;
}

.comet-product-bar__product-title {
    align-items: center;
    display: flex;
    color: $comet-color-neutral-38;
    font-size: $comet-font-size-header-level-4;
    text-decoration: none;
    padding:  $comet-space-inset-s;
    border-radius: $comet-border-radius;
    transition: $comet-transition-default;
    
    &:hover {
       text-decoration: none;
       background: transparent; //suppress hover state on smaller screens
    }

    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        color: $comet-color-white;
        &:hover {
            background: $comet-color-neutral-20;
        }
    }
}

.comet-product-bar__product-title-icon {
    fill: $comet-color-neutral-38;
    height: 40px;
    width: 100px;
    
    
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        .comet-product-bar__product-title:hover & {
            fill: $comet-color-white;
        }
    }
}


.comet-product-bar__actions {
    align-items: center;
    display: flex;
    list-style: none;
    margin: 0;
    margin-left: auto;
    padding: 0;
}

.comet-product-bar__action {
    margin: $comet-space-inline-left-s;
    position: relative;
    
    &:last-child {
        margin: 0;
    }
    
    .comet-popover--bottom-right-aligned {
        left: auto;
        right: 0;
    }
    
    .comet-list-group__row-label {
        white-space: nowrap;
    }
}

.comet-product-bar__action--separator-after-small {
    margin: $comet-space-inline-left-default;
}

.comet-product-bar__action--separator-after-large {
    margin: $comet-space-inline-left-l;
}

.comet-product-bar__action-link {
    align-items: center;
    border-radius: $comet-border-radius;
    justify-content: center;
        
    &.comet-button--hover,
    &:hover {
        background: $comet-color-neutral-80;
    }
    
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        &.comet-button--hover,
        &:hover {
            background: $comet-color-neutral-20;
        }
    }
        
    &.comet-product-bar__action-link--secondary.comet-button {
        display: none;
        
        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            display: flex;
        }
    }
    
    &.comet-button {
        display: flex;
        padding: $comet-space-inset-s;
        margin: 0;
        min-height: $comet-size-l;
    }
    
    &.comet-button--primary {
        &:hover {
            background-color: $comet-color-interactive-dark;
        }
    }

    .comet-button--icon__text {
        vertical-text-crop();
    }
}

.comet-product-bar__action-icon {
    fill: $comet-color-neutral-55;
    height: $comet-size-icon-m;
    width: $comet-size-icon-m;
    transition: fill $comet-transition-default;
    
    .comet-button--primary & {
        fill: $comet-color-white;
    }
    
    .comet-product-bar__action-link:hover & {
        fill: $comet-color-neutral-25;
    }
    
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        fill: $comet-color-neutral-80;

        .comet-product-bar__action-link:hover & {
            fill: $comet-color-white;
        }
    }
}

.comet-product-bar__action-hr {
    display: none;
}

.comet-product-bar__action-separator {
    background: $comet-color-neutral-38;
    display: none;
    height: 30px;
    margin: 0 $comet-space-default 0 $comet-space-s;
    width: 1px;
    
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        display: flex;
    }
}

.comet-product-bar__breadcrumbs {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) and (max-width: $comet-breakpoints-desktop) {
        .comet-page-shell__search-visible & {
            display: none;
        }
    }

    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        align-items: center;
        display: flex;
    }
}

.comet-product-bar__breadcrumb {
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        flex-shrink: 1;
    }
}

.comet-product-bar__breadcrumb-link {
    color: $comet-color-white;
    font-size: $comet-font-size-header-level-4;
    text-decoration: none;
    padding:  $comet-space-inset-s;
    border-radius: $comet-border-radius;
    transition: $comet-transition-default;
    
    &:hover {
        background: $comet-color-neutral-20;
    }
}

.comet-product-bar__breadcrumb-truncated-text + .comet-product-bar__breadcrumb-text {
    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        display: none;
    }
    
    @media screen and (min-width: $comet-breakpoints-desktop) {
        display: inline;
    }
}

.comet-product-bar__breadcrumb-truncated-text {
    @media screen and (min-width: $comet-breakpoints-desktop) {
        display: none;
    }
}



.comet-product-bar__breadcrumb-dim-text {
    color: $comet-color-neutral-65;
}

.comet-product-bar__breadcrumb-separator {
    line-height: 1;
    padding: $comet-space-inset-xs;
}

.comet-product-bar__breadcrumb-separator-icon {
    height: $comet-size-icon-m;
    fill: $comet-color-neutral-50;
    width: $comet-size-icon-m;
}

.comet-dropdown-menu.comet-product-bar__profile-dropdown {
    background: $comet-color-neutral-15;
    border: 0;
    height: 100vh;
    left: 0 !important;
    right: auto !important;
    top: 0 !important;
    max-width: none;
    width: 100vw;
    
    .comet-list-group {
        background: $comet-color-neutral-15;
    }
    
    @media screen and (min-width: $comet-breakpoints-tablet-narrow-portrait) {
        border-radius: $comet-border-radius;
        height: auto;
        left: auto !important;
        overflow: visible;
        right: 0 !important;
        top: 51px !important;
        width: 260px;   
        
        &:before {
            border: solid 10px $comet-color-neutral-15;
            border-color: rgba($comet-color-neutral-15, 0) rgba($comet-color-neutral-15, 0) $comet-color-neutral-15 rgba($comet-color-neutral-15, 0);
            content: '';
            display: block;
            position: absolute;
            right: 10px;
            top: -20px;
        }
        
        .comet-list-group {
            border-radius: $comet-border-radius;
        }
        
        .comet-list-group__row:first-child {
            border-radius: $comet-border-radius $comet-border-radius 0 0;
        }
        
        .comet-list-group__row:last-child {
            border-radius: 0 0 $comet-border-radius $comet-border-radius;
        }
    }
}

.comet-product-bar__action.comet-product-bar__action--profile {
    position: static;
    
    @media screen and (min-width: $comet-breakpoints-tablet-narrow-portrait) {
        position: relative;
    }

    .comet-dropdown-menu {
        max-height: none;
    }
}

// Additional specificity to override no-hairlines behavior for this one row
.comet-list-group--no-hairlines .comet-product-bar__profile-dropdown-name-row {
    @media screen and (min-width: $comet-breakpoints-tablet-narrow-portrait) {
        border-bottom: solid 1px $comet-color-neutral-38;
    }
}

.comet-product-bar__profile-dropdown-name-row {
    background: $comet-color-neutral-32;
    
    @media screen and (min-width: $comet-breakpoints-tablet-narrow-portrait) {
        background: transparent;
    }
    
    .comet-list-group__row-anchor {
        align-items: center;
        display: flex;
        flex-direction: column;
        height: 200px;
        justify-content: center;
        text-align: center;
        
        @media screen and (min-width: $comet-breakpoints-tablet-narrow-portrait) {
            flex-direction: row;
            height: auto;
            justify-content: flex-start;
            text-align: left;
        }
    }

    .comet-list-group__avatar {
        display: block;
        height: $comet-size-xl;
        margin-right: 0;
        width: $comet-size-xl;
        
        @media screen and (min-width: $comet-breakpoints-tablet-narrow-portrait) {
            height: $comet-size-l;
            margin: $comet-space-inline-left-xs;
            width: $comet-size-l;
        }
    }
    
    .comet-list-group__row-label {
        flex: 0;
        white-space: normal;
        @media screen and (min-width: $comet-breakpoints-tablet-narrow-portrait) {
            flex: 1;
        }
    }
}

.comet-product-bar__profile-dropdown-header {
    align-items: center;
    display: flex;
    height: 50px;
    justify-content: center;
    position: relative;
    
    @media screen and (min-width: $comet-breakpoints-tablet-narrow-portrait) {
        display: none;
    }
}

.comet-product-bar__view-profile-link-text {
    color: $comet-text-color-secondary-on-dark;
    display: block;
    font-size: $comet-font-size-vs;
    text-decoration: underline;
}

.comet-product-bar__profile-dropdown-header-title {
    color: $comet-color-white;
    font-weight: normal;
}

.comet-product-bar__profile-dropdown-header-close {
    align-items: center;
    background: $comet-color-black;
    display: flex;
    height: 50px;
    justify-content: center;
    position: absolute;
    right: 0;
    top: 0;
    width: 50px;
}

.comet-product-bar__profile-dropdown-header-close-icon {
    fill: $comet-color-white;
    height: $comet-size-icon-m;
    width: $comet-size-icon-m;
}


.comet-product-bar__search {
    visibility: collapse;
    position: absolute;
    right: 0;
    top: 0;
    z-index: 100;

    .comet-page-shell__search-visible & {
        // small screen reveal, all variations
        background: $comet-color-neutral-90;
        visibility: visible;
        position: fixed;
        width: 100%

        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            // large screen reveal, all variations
            background: $comet-color-neutral-25;
            border-radius: $comet-border-radius;
            visibility: visible;
            position: absolute;
            width: auto;
        }
    }
}

.comet-product-bar__search-revealed-static .comet-product-bar__search {
    // small screen, default is still closed up = leave default

    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        // large screen override for this variation
        visibility: visible;

        .comet-product-bar__close-search, // don't need a close button
        .comet-product-bar__search-panel-trigger { // don't need a reveal button
            display: none;
        }
    }
}

.comet-product-bar__search-panel-trigger {
    // default looks normal

    .comet-product-bar__search-revealed-static & {
        // static search box completely suppresses the trigger button, except on small screens

        @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
            display: none;
        }
    }
}

.comet-product-bar__search-inner {
    display: flex;
    padding: 7px;

    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        padding: 0;
    }
}

.comet-product-bar__search-box-wrapper {
    // isolates search input and submit button together
    display: flex;
    margin: 0 0 0 auto;
    position: relative;
}

.comet-product-bar__search-input {
    margin: 0;
    padding: $comet-space-s 50px $comet-space-s $comet-space-s;
    width: 260px;
    border: 0;
    height: 35px; // enforce height to match button

    &:focus {
        border: 0;
    }

    @media screen and (min-width: $comet-breakpoints-tablet-portrait) {
        padding: $comet-space-xs 50px $comet-space-xs $comet-space-s;
    }
}

.comet-product-bar__search-button {
    background-color: $comet-color-white;
    margin-right: 0;
    padding-bottom: $comet-size-default;
    padding-top: $comet-size-default - 1;
    height: 35px; // enforce height to match input
    position: absolute;
    right: 0;
    top: 0;
    border-radius: 0 $comet-space-xs $comet-space-xs 0;
    border: 0;
    transition: background-color $comet-transition-default;

    &:hover,
    &:focus {
        background-color: $comet-color-neutral-80;
    }
}

.comet-product-bar__search-button .comet-button__icon {
    fill: $comet-color-interactive-default;
}

.comet-button.comet-product-bar__action-link.comet-product-bar__close-search {
    margin-left: $comet-space-s;
    @media screen and (min-width: $comet-breakpoints-desktop) {
        display: none;
    }
}

.comet-product-bar__search {
    .comet-list-group__row-anchor:focus {
        background-color: $comet-color-neutral-95; //match hover style, in this context
    }
}